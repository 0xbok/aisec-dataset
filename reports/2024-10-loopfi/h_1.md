## [H] Rewards might be lost due to the error that `_updateRewardIndex()` might advance `lastBalance` without advancing index for a token

The function `_updateRewardIndex()` is used to update the `lastBalance` and `index` of each reward token. This function will be called when a user deposits, withdraws collateral or claims rewards.

However, the function might not advance `index` when `accrued.divDown(totalShares) = 0`. This might happen when `totalShares` is too big and `accrued` is too small. One case is that the number of decimals for the reward token is too small.

[src/pendle-rewards/RewardManager.sol#L74](repos/2024-10-loopfi/src/pendle-rewards/RewardManager.sol#L74)

For example, the USDC token only has 6 decimals.

Suppose `accrued` = `$100 = 100*10**6`, and `totalShares` `= 200M = 200 * 10** 6 * 10**18`; then we have Â `accrued.divDown(totalShares) = 0`.

Furthermore, if function `_updateRewardIndex()` is called more frequently, either because a malicious user keeps calling `getRewards()` (the gas fee is low on Arbitrum) or simply because the community is large so there is a high chance that for each block (per 12 seconds on Ethereum), there is someone who calls a `withdraw`/`deposit`/`getRewards` function. As a result, `accrued` could be small, leading to `accrued.divDown(totalShares) = 0`. Meanwhile, `_updateRewardIndex()` always advances `lastBalance` when `accrued !=0`:

[src/pendle-rewards/RewardManager.sol#L78](repos/2024-10-loopfi/src/pendle-rewards/RewardManager.sol#L78)

This means the accrued rewards are lost! Nobody will receive the rewards since index has not changed.

More importantly, due to the rounding down error for `accrued.divDown(totalShares)`, there is always a slight loss for the rewards, which is accumulative over time.