## [M] Attacker can DOS user from selling shares of a `credId`

The Cred.sol contract provides a `buyShareCredFor()` function which anyone can use to buy shares for another curator. We also know that once a share is bought, the curator needs to serve a 10 minute share lock period before being able to sell those tokens.

### Impact

The issue is that an attacker can purchase 1 share every 10 minutes on behalf of the curator to DOS them from selling. As we can see on the bonding share price curve docs [here](https://docs.google.com/spreadsheets/d/18wHi9Mqo9YU8EUMQuUvuC75Dav6NSY5LOw-iDlkrZEA/edit?pli=1\&gid=859106557#gid=859106557), the price to buy 1 share starts from 2.46 USD and barely increases. Each share bought = 10 minutes of delay for the victim user.

Delaying the user from selling is not the only problem though. During these delays, the price of the share can drop, which could ruin a user's trade strategy causing to incur more loss.

### Proof of Concept

Refer to the price curve [here](https://docs.google.com/spreadsheets/d/18wHi9Mqo9YU8EUMQuUvuC75Dav6NSY5LOw-iDlkrZEA/edit?pli=1\&gid=859106557#gid=859106557) for cost of shares.

1. Let's assume 30 shares have been bought already by users A, B and C (we ignore the 1 share given to the creator). The shares were bought in order, i.e., 10 first by A, then B and then C. This means A bought 10 shares for 25 USD, B for 30 USD and C for 35 USD. The price of 1 share currently is 4 USD as per the price curve after all buys.
2. Let's say A and C hold the shares for a bit longer while B is looking to sell them as soon as possible to profit from C's buy that increased the price.
3. Now let's say the attacker calls function `buyShareCredFor()` with user B as the curator. This would be done close to the end of the 10 minute share lock period of user B.

```solidity
File: Cred.sol
186:     function buyShareCredFor(uint256 credId_, uint256 amount_, address curator_, uint256 maxPrice_) public payable {
187:         if (curator_ == address(0)) revert InvalidAddressZero();
188:         _handleTrade(credId_, amount_, true, curator_, maxPrice_);
189:     }
```

4. When the attacker's call goes through to the internal function `_handleTrade()`, the `lastTradeTimestamp` is updated for the user B. This means B has to serve the share lock period all over again for 10 minutes. Note that this would provide user B with 1 more share (which costs the attacker 4 USD).

```solidity
File: Cred.sol
642:         if (isBuy) {
643:             cred.currentSupply += amount_;
644:             ...
649:             lastTradeTimestamp[credId_][curator_] = block.timestamp;
```

5. User B tries to sell but isn't able to due to the share lock period check in `_handleTrade()`.

```solidity
File: Cred.sol
629:             if (block.timestamp <= lastTradeTimestamp[credId_][curator_] + SHARE_LOCK_PERIOD) {
630:                 revert ShareLockPeriodNotPassed(
631:                     block.timestamp, lastTradeTimestamp[credId_][curator_] + SHARE_LOCK_PERIOD
632:                 );
633:             }
```

6. Users C and A sell their shares of the `credId` during this period for 36 USD and 31 USD respectively. This brings the price per share down to 2.57 USD, which for user B would mean 25.7 USD. This means user B lost 4.3 USD approximately from the initial buy.
7. Note that user C could also have been the attacker where the net loss of the attacker; i.e., C would result to `4 USD - (final sell amount - initial purchase amount) = 4 USD - (36 USD - 35 USD) = 3 USD`.
8. Overall in addition to grief DOSing a user from selling, other users are able to alter another user's strategy by preventing them from selling.



