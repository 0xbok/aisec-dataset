## [M] Potential uninitialized `entropySlots` reading in `getNextEntropy`, causing 0 entropy mint

The `getNextEntropy` function can be called at any time without waiting for the write entropy batches process to finish. This could lead to the function returning an uninitialized entropy value of `000000`, resulting in users losing funds to mint useless tokens and not being eligible for future airdrops as they get 0 shares. This vulnerability can severely impact the users' trust and the protocol's functionality.

### Proof of Concept

Found in contracts/EntropyGenerator/EntropyGenerator.sol at [Line 103](repos/2024-07-traitforge/contracts/EntropyGenerator/EntropyGenerator.sol#L103):

> If `currentSlotIndex > lastInitializedIndex` (`writeEntropyBatch` process not complete), `getEntropy` would return entropy = 000000 instead of revert. Which leads to user mint entities with 0 entropy.

```solidity

101:  function getNextEntropy() public onlyAllowedCaller returns (uint256) { 
102:    require(currentSlotIndex <= maxSlotIndex, 'Max slot index reached.');
103:@>     uint256 entropy = getEntropy(currentSlotIndex, currentNumberIndex); 
104:
    ...
120:  }
```

### POC

Apply following POC via git `apply POC.patch` and run `yarn test`. The test confirms `getNextEntropy` did return entropy 0 instead of revert.

```patch
diff --git a/test/EntropyGenerator.test.ts b/test/EntropyGenerator.test.ts
index 69551f5..f7e8698 100644
--- a/test/EntropyGenerator.test.ts
+++ b/test/EntropyGenerator.test.ts
@@ -3,7 +3,7 @@ import { ethers } from 'hardhat';
 import { EntropyGenerator } from '../typechain-types';
 import { HardhatEthersSigner } from '@nomicfoundation/hardhat-ethers/signers';
 
-describe('EntropyGenerator', function () {
+describe.only('EntropyGenerator', function () {
   let entropyGenerator: EntropyGenerator;
   let owner: HardhatEthersSigner;
   let allowedCaller: HardhatEthersSigner;
@@ -32,6 +32,15 @@ describe('EntropyGenerator', function () {
     expect(updatedCaller).to.equal(allowedCaller);
   });
 
+  it('getNextEntropy returns 0 entropy if entropySlots not properly init', async function () {
+    // call getNextEntropy when write entropy batches not finished
+    await expect(
+      entropyGenerator.connect(allowedCaller).getNextEntropy()
+    ).to.emit(entropyGenerator, 'EntropyRetrieved').withArgs(0);
+
+    // @audit: should revert getNextEntropy if entropySlots not properly init
+  });
+
   it('should write entropy batches 1', async function () {
     // Write entropy batch 1
     await entropyGenerator.writeEntropyBatch1();
```



