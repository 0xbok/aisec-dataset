## [M] Each generation should have 1 "Golden God" NFT, but there could be 0

[contracts/EntropyGenerator/EntropyGenerator.sol#L206](repos/2024-07-traitforge/contracts/EntropyGenerator/EntropyGenerator.sol#L206)

[contracts/TraitForgeNft/TraitForgeNft.sol#L345](repos/2024-07-traitforge/contracts/TraitForgeNft/TraitForgeNft.sol#L345)

[contracts/EntropyGenerator/EntropyGenerator.sol#L10](repos/2024-07-traitforge/contracts/EntropyGenerator/EntropyGenerator.sol#L10)

### Vulnerability Details

The location of the "Golden God" NFT with entropy of `999999` is calculated by the `initializeAlphaIndices` function in the `EntropyGenerator` contract.

```js
    function initializeAlphaIndices() public whenNotPaused onlyOwner {
        uint256 hashValue = uint256(keccak256(abi.encodePacked(blockhash(block.number - 1), block.timestamp)));

        uint256 slotIndexSelection = (hashValue % 258) + 512;
        uint256 numberIndexSelection = hashValue % 13;

        slotIndexSelectionPoint = slotIndexSelection;
        numberIndexSelectionPoint = numberIndexSelection;
    }
```

It is confirmed by the devs/sponsors that `TraitForgeNft` contract is the only allowed caller of the `initializeAlphaIndices`. As we can see, the function is protected by a modifier and when the generation is getting incremented, `TraitForgeNft` is the caller.

```js
TraitForgeNft.sol

    function _incrementGeneration() private {
        require(generationMintCounts[currentGeneration] >= maxTokensPerGen, "Generation limit not yet reached");
        currentGeneration++;
        generationMintCounts[currentGeneration] = 0;
        priceIncrement = priceIncrement + priceIncrementByGen;
@>      entropyGenerator.initializeAlphaIndices();
        emit GenerationIncremented(currentGeneration);
    }
```

Each generation is supposed to contain 1 "Golden God" NFT. According to the [TraitForge docs](https://docs.google.com/document/d/1pihtkKyyxobFWdaNU4YfAy56Q7WIMbFJjSHUAfRm6BA/edit):

> Entropy is set into uint256 slots, with each slot able to contain a 78 digit number - or 13 concatenated entropies. Thus 770 slots are needed to contain 10,000 entropies.

Entropies are stored in the following array:

```js
    uint256[770] private entropySlots; // Array to store entropy values
```

We have 770 slots with 13 entropies each, which means `770 * 13 = 10,010` total entropies generated.

The last 10 entropies are skipped when the generation ends, since there is a max mint value of 10,000 NFTs per generation and when it is reached, it increments to the next generation. There is a chance that the `999999` entropy is placed in the last entropy slot, in the last 10 entropies of that slot and is lost and not mintable. Since the generation has incremented by the `TraitForgeNft` contract, the action is not recoverable.

### Impact

There is a chance that the "Golden God" NFT is completely lost and not mintable for a generation. This goes against the docs and the expectations of the game.

### Proof of Concept

1. 10,000 NFTs get minted in a generation, so it's time to increment to the next generation.
2. `TraitForgeNft` contract increments generation and calls the `initializeAlphaIndices` to set the location of the "Golden God".
3. "Golden God" entropy is set in the last slot (770th), in the last 10 entropy slots.
4. The "Golden God" NFT is not mintable, as there needs to be more than 10,000 mints in the generation, which is not possible.



